<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>
        <%=title%>
    </title>
    <link rel='stylesheet' href='/main.css' />
</head>
<body>
    <h1>
        <%= title%>
    </h1>
    <a id="exit-btn" href="/">방 나가기</a>
    <fieldset>
        <legend>채팅 내용</legend>
        <div id="chat-list">
            <%for(var i=0;i<chats.length;i++){
                const chat = chats[i];
            %>
                <%if(chat.user === user){%>
                    <div class="mine" style="color:'<%=chat.user%>'">
                        <div><%=chat.user%></div>
                        <%if(chat.gif){%>
                            <img src="/gif/'<%=chat.gif%>'"/>
                        <%}else{%>
                            <div><%= chat.chat%></div>
                        <%}%>
                    </div>
                <%}else if(chat.user === 'system'){%>
                    <div class="system">
                        <div><%= chat.chat%></div>
                    </div>
                <%} else {%>
                    <div class="other" style="color:'<%=chat.user%>'">
                        <div><%=chat.user%></div>
                        <%if(chat.gif){%>
                            <img src='/gif/"<%=chat.gif%>"'/>
                        <%}else{%>
                            <div><%= chat.chat%></div>
                        <%}%>
                    </div>
                <%}%>
            <%}%>
        </div>
    </fieldset>
    <form id="chat-form" action="/chat" method="post" entype="multipart/form-data">
        <label for="gif">GIF 올리기</label>
        <input id="gif" type="file" name="gif" accept="image/gif"/>
        <input id="chat" name="chat"/>
        <button type="submit">전송</button>
    </form>
    <script src='/socket.io/socket.io.js'></script>
    <script>
        var socket = io.connect('http://localhost:8005/chat', {
                path: '/socket.io'
            });
            socket.on('join', function (data) {
                var div = document.createElement('div');
                div.classList.add('system');
                var chat = document.createElement('div');
                div.textContent = data.chat;
                div.appendChild(chat);
                document.querySelector('#chat-list').appendChild(div);
            });
            socket.on('exit', function (data) {
                var div = document.createElement('div');
                div.classList.add('system');
                var chat = document.createElement('div');
                div.textContent = data.chat;
                div.appendChild(chat);
                document.querySelector('#chat-list').appendChild(div);
            });
    </script>
</body>

</html>